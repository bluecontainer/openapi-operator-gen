# Generated by openapi-operator-gen {{ .GeneratorVersion }}
# Example {{ .Kind }} CR - creates and manages multiple resources as a single unit
#
# A bundle defines embedded resource specs that are created as child CRs.
# Child resources are automatically cleaned up when the bundle is deleted.
#
# Dependencies are automatically derived from ${resources.<id>...} references.
# You can also use explicit dependsOn declarations if needed.

---
# Simple bundle - create multiple resources
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: simple-bundle
  namespace: default
spec:
  # Target settings (inherited by child resources)
  # target:
  #   helmRelease: my-release
  #   namespace: backend
  #   # Single static URL:
  #   # baseURL: "http://api.example.com:8080"
  #   # Multiple static URLs (fan-out to all):
  #   # baseURLs:
  #   #   - "http://api-1.example.com:8080"
  #   #   - "http://api-2.example.com:8080"
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if lt $i 2 }}
    - id: {{ $kind | lower }}-{{ $i }}
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
---
# Bundle with parent-child relationship using CEL expressions
# The child resource references the parent's externalID via ${resources.<id>.status.externalID}
# Dependencies are automatically inferred from the CEL expression
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: parent-child-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # Parent resource - created first
    - id: parent-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- if eq $i 1 }}
    # Child resource - references parent's externalID
    # Dependency on parent is automatically inferred from the ${resources...} reference
    - id: child-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
{{- if isParentIDField .JSONName }}
        # Reference parent's external ID (creates implicit dependency)
        {{ .JSONName }}: "${resources.parent-{{ index $.ResourceKinds 0 | lower }}.status.externalID}"
{{- else }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
---
# Bundle with explicit dependencies (when not using CEL references)
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: explicit-dependency-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # First resource - no dependencies (parent)
    - id: primary-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- if eq $i 1 }}
    # Second resource - explicit dependency (child depends on parent)
    - id: secondary-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
      dependsOn:
        - primary-{{ index $.ResourceKinds 0 | lower }}
{{- end }}
{{- end }}
---
# Bundle with conditional resource creation
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: conditional-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # Always created (parent)
    - id: main
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- if eq $i 1 }}
    # Conditionally created based on a condition (child)
    - id: optional
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
      # Skip this resource if condition is true
      skipWhen:
        - "false"  # Always create for this example
{{- end }}
{{- end }}
---
# Bundle with readyWhen conditions
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: bundle-with-ready-conditions
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    - id: backend
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
      # Custom condition for when this resource is considered ready
      readyWhen:
        - "resources.backend.status.state == 'Synced'"
{{- end }}
{{- if eq $i 1 }}
    - id: frontend
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
      dependsOn:
        - backend
      readyWhen:
        - "resources.frontend.status.state == 'Synced'"
{{- end }}
{{- end }}
---
# Paused bundle - reconciliation is suspended
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: paused-bundle
  namespace: default
spec:
  paused: true  # Set to false to resume reconciliation
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    - id: example
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- if or .QueryKinds .ActionKinds }}
---
# Bundle with mixed resource types (CRUD, Query, Action)
# Child resources reference the parent resource's externalID
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: mixed-types-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # Parent resource - created first (needed by child resources)
    - id: parent-resource
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- if eq $i 1 }}
    # Child resource - references parent's externalID
    - id: child-resource
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
{{- if isParentIDField .JSONName }}
        # Reference parent's external ID
        {{ .JSONName }}: "${resources.parent-resource.status.externalID}"
{{- else }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- range $i, $kind := .QueryKinds }}
{{- if eq $i 0 }}
    # Query CRD (periodic queries)
    - id: status-query
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- range $i, $kind := .ActionKinds }}
{{- if eq $i 0 }}
    # Action CRD - references parent's externalID
    - id: upload-action
      kind: {{ $kind }}
      spec:
{{- range getSpec $kind }}
{{- if and (not .IsTargeting) (not (isPrimaryID .JSONName)) }}
{{- if isParentIDField .JSONName }}
        # Reference parent's external ID (creates implicit dependency)
        {{ .JSONName }}: "${resources.parent-resource.status.externalID}"
{{- else }}
        {{ .JSONName }}: {{ .ExampleValue }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
