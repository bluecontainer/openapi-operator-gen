# Generated by openapi-operator-gen {{ .GeneratorVersion }}
# Example {{ .Kind }} CR - creates and manages multiple resources as a single unit
#
# A bundle defines embedded resource specs that are created as child CRs.
# Child resources are automatically cleaned up when the bundle is deleted.
#
# Dependencies are automatically derived from ${resources.<id>...} references.
# You can also use explicit dependsOn declarations if needed.

---
# Simple bundle - create multiple resources
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: simple-bundle
  namespace: default
spec:
  # Target settings (inherited by child resources)
  # targetHelmRelease: my-release
  # targetNamespace: backend
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if lt $i 2 }}
    - id: {{ $kind | lower }}-{{ $i }}
      kind: {{ $kind }}
      spec:
        name: "bundle-created-{{ $kind | lower }}"
{{- end }}
{{- end }}
---
# Bundle with dependencies - order of creation matters
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: ordered-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # First resource - no dependencies
    - id: primary-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
        name: "primary-resource"
{{- end }}
{{- if eq $i 1 }}
    # Second resource - depends on the first
    - id: dependent-{{ $kind | lower }}
      kind: {{ $kind }}
      spec:
        name: "dependent-resource"
      dependsOn:
        - primary-{{ index $.ResourceKinds 0 | lower }}
{{- end }}
{{- end }}
---
# Bundle with CEL expression references - dependencies are auto-derived
# Use ${resources.<id>.status.<field>} to reference other resource values
# No explicit dependsOn needed - it's inferred from the ${resources.parent...} reference
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: bundle-with-references
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # Parent resource
    - id: parent
      kind: {{ $kind }}
      spec:
        name: "parent-resource"
{{- end }}
{{- if eq $i 1 }}
    # Child resource using parent's external ID
    # Dependency on 'parent' is automatically inferred from the reference below
    - id: child
      kind: {{ $kind }}
      spec:
        name: "child-of-${resources.parent.status.externalID}"
{{- end }}
{{- end }}
---
# Bundle with conditional resource creation
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: conditional-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # Always created
    - id: main
      kind: {{ $kind }}
      spec:
        name: "main-resource"
{{- end }}
{{- if eq $i 1 }}
    # Conditionally created based on a condition
    - id: optional
      kind: {{ $kind }}
      spec:
        name: "optional-resource"
      # Skip this resource if condition is true
      skipWhen:
        - "false"  # Always create for this example
{{- end }}
{{- end }}
---
# Bundle with readyWhen conditions
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: bundle-with-ready-conditions
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    - id: backend
      kind: {{ $kind }}
      spec:
        name: "backend-service"
      # Custom condition for when this resource is considered ready
      readyWhen:
        - "resources.backend.status.state == 'Synced'"
{{- end }}
{{- if eq $i 1 }}
    - id: frontend
      kind: {{ $kind }}
      spec:
        name: "frontend-service"
      dependsOn:
        - backend
      readyWhen:
        - "resources.frontend.status.state == 'Synced'"
{{- end }}
{{- end }}
---
# Paused bundle - reconciliation is suspended
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: paused-bundle
  namespace: default
spec:
  paused: true  # Set to false to resume reconciliation
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    - id: example
      kind: {{ $kind }}
      spec:
        name: "paused-resource"
{{- end }}
{{- end }}
{{- if or .QueryKinds .ActionKinds }}
---
# Bundle with mixed resource types (CRUD, Query, Action)
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .Kind }}
metadata:
  name: mixed-types-bundle
  namespace: default
spec:
  resources:
{{- range $i, $kind := .ResourceKinds }}
{{- if eq $i 0 }}
    # CRUD Resource
    - id: main-resource
      kind: {{ $kind }}
      spec:
        name: "created-resource"
{{- end }}
{{- end }}
{{- range $i, $kind := .QueryKinds }}
{{- if eq $i 0 }}
    # Query CRD (periodic queries)
    - id: status-query
      kind: {{ $kind }}
      spec: {}
{{- end }}
{{- end }}
{{- range $i, $kind := .ActionKinds }}
{{- if eq $i 0 }}
    # Action CRD (one-shot operations)
    - id: post-create-action
      kind: {{ $kind }}
      spec: {}
      dependsOn:
        - main-resource
{{- end }}
{{- end }}
{{- end }}
