# Generated by openapi-operator-gen {{ .GeneratorVersion }}
# Example {{ .BundleKind }} CR without status (spec only)
# This demonstrates creating a bundle CR for testing
#
# Usage with cel-test:
#   cel-test expressions --cr testdata/bundle.yaml
#   cel-test expressions --cr testdata/bundle.yaml --resources testdata/resources.yaml
apiVersion: {{ .APIGroup }}/{{ .APIVersion }}
kind: {{ .BundleKind }}
metadata:
  name: {{ .AppName }}-bundle
  namespace: default
spec:
  # Resources to include in the bundle
  resources:
{{- range .ResourceKinds }}
    - kind: {{ . }}
      name: my-{{ . | lower }}
{{- end }}
  # Derived values using CEL expressions
  derivedValues:
    - name: syncPercentage
      expression: "summary.total > 0 ? (summary.synced * 100) / summary.total : 0"
    - name: allSynced
      expression: "summary.total > 0 && summary.synced == summary.total"
    - name: failedResources
      expression: "resources.filter(r, r.status.state == 'Failed').size()"
{{- range $i, $kind := .ResourceKinds }}
    - name: {{ $kind | lower }}Count
      expression: "resources.filter(r, r.kind == '{{ $kind }}').size()"
{{- end }}
