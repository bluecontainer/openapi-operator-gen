# {{ .TitleAppName }} Operator

Generated Kubernetes operator that manages {{ .AppName }} resources by syncing Custom Resources with the backing REST API.

Generated by [openapi-operator-gen](https://github.com/bluecontainer/openapi-operator-gen) {{ .GeneratorVersion }}.

## Build Commands

```bash
# Install dependencies
go mod tidy

# Build the operator binary
make build

# Run all tests (requires envtest binaries)
make test

# Generate CRD manifests and RBAC from Go markers
make manifests

# Generate DeepCopy methods
make generate

# Build container image
make docker-build IMG=<registry>/{{ .AppName }}-operator:latest

# Install CRDs into the current cluster
make install

# Deploy operator to the current cluster
make deploy IMG=<registry>/{{ .AppName }}-operator:latest
```

## Generator Command

This operator was generated with:

```bash
{{ .GeneratorCmd }}
```

To regenerate after modifying the OpenAPI spec, re-run this command. All files listed under "Regenerated Files" below will be overwritten.

## Custom Resource Definitions

| Kind | Type | Description |
|------|------|-------------|
{{- range .CRDs }}
| {{ .Kind }} | {{ if .IsQuery }}QueryEndpoint{{ else if .IsAction }}ActionEndpoint{{ else }}Resource{{ end }} | {{ if .IsQuery }}Read-only query{{ else if .IsAction }}One-shot action{{ else }}Full CRUD lifecycle{{ end }} |
{{- end }}
{{- if .HasAggregate }}
| {{ .TitleAppName }}Aggregate | Aggregate | Read-only health aggregation across resources |
{{- end }}
{{- if .HasBundle }}
| {{ .TitleAppName }}Bundle | Bundle | Orchestrated creation of multiple child resources |
{{- end }}

API Group: `{{ .APIGroup }}`
API Version: `{{ .APIVersion }}`

## File Ownership

**Regenerated** (overwritten on re-generation — do not hand-edit):
- `api/{{ .APIVersion }}/` — CRD Go types with kubebuilder markers
- `internal/controller/` — Reconciliation logic for each CRD
- `config/crd/` — CRD YAML manifests
- `main.go` — Controller manager entrypoint
- `Dockerfile`, `Makefile`, `go.mod`

**Safe to customize:**
- `config/manager/` — Deployment resource limits, replicas, env vars
- `config/rbac/` — Additional RBAC rules beyond generated defaults
- `config/samples/` — Example CR YAML files (useful references)
- `config/default/` — Kustomize overlays for deployment
- `hack/` — Build scripts and boilerplate

## Architecture

Each CRD controller follows a GET-first reconciliation pattern:
1. GET current state from the REST API
2. Compare with the CR spec (drift detection)
3. CREATE or UPDATE only if needed
4. Finalizers ensure cleanup on CR deletion

Endpoint discovery supports: StatefulSet, Deployment, Helm release, and direct URL targeting.
