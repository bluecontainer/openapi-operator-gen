#!/bin/bash
# Generated by openapi-operator-gen v0.0.10-20-ge0145f7-dirty
# Node source script for Rundeck resource model discovery (native execution)
# Discovers Kubernetes workloads (Helm releases, StatefulSets, Deployments) as Rundeck nodes.
# Node attributes (targetType, targetValue, targetNamespace) map to kubectl plugin --target-* flags.
set -euo pipefail

export PATH=/home/rundeck/server/data:$PATH

K8S_TOKEN=$(curl -sf \
  -H 'X-Rundeck-Auth-Token: letmein99' \
  -H 'Accept: application/x-rundeck-data-password' \
  'http://localhost:4440/api/14/storage/keys/project/petstore-operator/k8s-token')

K8S_URL=$(curl -sf \
  -H 'X-Rundeck-Auth-Token: letmein99' \
  'http://localhost:4440/api/14/project/petstore-operator/config' \
  | grep -oE '"project\.globals\.k8s_url":"[^"]*"' | sed 's/.*:"\([^"]*\)"/\1/')

kubectl-petstore nodes -n petstore-system \
  --server="$K8S_URL" \
  --token="$K8S_TOKEN" \
  --insecure-skip-tls-verify
