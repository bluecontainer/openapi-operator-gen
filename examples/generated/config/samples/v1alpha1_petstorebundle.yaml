# Generated by openapi-operator-gen v0.0.9-25-g94f0366-dirty
# Example PetstoreBundle CR - creates and manages multiple resources as a single unit
#
# A bundle defines embedded resource specs that are created as child CRs.
# Child resources are automatically cleaned up when the bundle is deleted.
#
# Dependencies are automatically derived from ${resources.<id>...} references.
# You can also use explicit dependsOn declarations if needed.

---
# Simple bundle - create multiple resources
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: simple-bundle
  namespace: default
spec:
  # Target settings (inherited by child resources)
  # targetHelmRelease: my-release
  # targetNamespace: backend
  resources:
    - id: pet-0
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
    - id: order-1
      kind: Order
      spec:
        complete: false
        petId: 10
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
---
# Bundle with parent-child relationship using CEL expressions
# The child resource references the parent's externalID via ${resources.<id>.status.externalID}
# Dependencies are automatically inferred from the CEL expression
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: parent-child-bundle
  namespace: default
spec:
  resources:
    # Parent resource - created first
    - id: parent-pet
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
    # Child resource - references parent's externalID
    # Dependency on parent is automatically inferred from the ${resources...} reference
    - id: child-order
      kind: Order
      spec:
        complete: false
        # Reference parent's external ID (creates implicit dependency)
        petId: "${resources.parent-pet.status.externalID}"
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
---
# Bundle with explicit dependencies (when not using CEL references)
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: explicit-dependency-bundle
  namespace: default
spec:
  resources:
    # First resource - no dependencies (parent)
    - id: primary-pet
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
    # Second resource - explicit dependency (child depends on parent)
    - id: secondary-order
      kind: Order
      spec:
        complete: false
        petId: 10
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
      dependsOn:
        - primary-pet
---
# Bundle with conditional resource creation
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: conditional-bundle
  namespace: default
spec:
  resources:
    # Always created (parent)
    - id: main
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
    # Conditionally created based on a condition (child)
    - id: optional
      kind: Order
      spec:
        complete: false
        petId: 10
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
      # Skip this resource if condition is true
      skipWhen:
        - "false"  # Always create for this example
---
# Bundle with readyWhen conditions
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: bundle-with-ready-conditions
  namespace: default
spec:
  resources:
    - id: backend
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
      # Custom condition for when this resource is considered ready
      readyWhen:
        - "resources.backend.status.state == 'Synced'"
    - id: frontend
      kind: Order
      spec:
        complete: false
        petId: 10
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
      dependsOn:
        - backend
      readyWhen:
        - "resources.frontend.status.state == 'Synced'"
---
# Paused bundle - reconciliation is suspended
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: paused-bundle
  namespace: default
spec:
  paused: true  # Set to false to resume reconciliation
  resources:
    - id: example
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
---
# Bundle with mixed resource types (CRUD, Query, Action)
# Child resources reference the parent resource's externalID
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: mixed-types-bundle
  namespace: default
spec:
  resources:
    # Parent resource - created first (needed by child resources)
    - id: parent-resource
      kind: Pet
      spec:
        category: {"id": 1, "name": "Dogs"}
        name: "Fluffy"
        photoUrls: ["https://example.com/photos/fluffy.jpg"]
        status: "available"
        tags: [{"id": 1, "name": "friendly"}]
    # Child resource - references parent's externalID
    - id: child-resource
      kind: Order
      spec:
        complete: false
        # Reference parent's external ID
        petId: "${resources.parent-resource.status.externalID}"
        quantity: 2
        shipDate: "2026-01-27T16:35:36Z"
        status: "placed"
    # Query CRD (periodic queries)
    - id: status-query
      kind: PetFindbystatusQuery
      spec:
        status: "available"
    # Action CRD - references parent's externalID
    - id: upload-action
      kind: PetUploadimageAction
      spec:
        # Reference parent's external ID (creates implicit dependency)
        petId: "${resources.parent-resource.status.externalID}"
        reExecuteInterval: "5m"
        additionalMetadata: "example-additionalMetadata"
        data: "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="
        dataFrom: {"configMapRef": {"name": "my-image-data", "key": "image.png"}}
        dataURL: "https://example.com/images/photo.png"
        dataFromFile: {"path": "/data/image.png"}
        contentType: "image/png"
