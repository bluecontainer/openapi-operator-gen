# Generated by openapi-operator-gen v0.0.9-4-g50611dd-dirty
# Example PetstoreBundle CR - creates and manages multiple resources as a single unit
#
# A bundle defines embedded resource specs that are created as child CRs.
# Child resources are automatically cleaned up when the bundle is deleted.
#
# Dependencies are automatically derived from ${resources.<id>...} references.
# You can also use explicit dependsOn declarations if needed.

---
# Simple bundle - create multiple resources
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: simple-bundle
  namespace: default
spec:
  # Target settings (inherited by child resources)
  # targetHelmRelease: my-release
  # targetNamespace: backend
  resources:
    - id: order-0
      kind: Order
      spec:
        name: "bundle-created-order"
    - id: pet-1
      kind: Pet
      spec:
        name: "bundle-created-pet"
---
# Bundle with dependencies - order of creation matters
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: ordered-bundle
  namespace: default
spec:
  resources:
    # First resource - no dependencies
    - id: primary-order
      kind: Order
      spec:
        name: "primary-resource"
    # Second resource - depends on the first
    - id: dependent-pet
      kind: Pet
      spec:
        name: "dependent-resource"
      dependsOn:
        - primary-order
---
# Bundle with CEL expression references - dependencies are auto-derived
# Use ${resources.<id>.status.<field>} to reference other resource values
# No explicit dependsOn needed - it's inferred from the ${resources.parent...} reference
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: bundle-with-references
  namespace: default
spec:
  resources:
    # Parent resource
    - id: parent
      kind: Order
      spec:
        name: "parent-resource"
    # Child resource using parent's external ID
    # Dependency on 'parent' is automatically inferred from the reference below
    - id: child
      kind: Pet
      spec:
        name: "child-of-${resources.parent.status.externalID}"
---
# Bundle with conditional resource creation
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: conditional-bundle
  namespace: default
spec:
  resources:
    # Always created
    - id: main
      kind: Order
      spec:
        name: "main-resource"
    # Conditionally created based on a condition
    - id: optional
      kind: Pet
      spec:
        name: "optional-resource"
      # Skip this resource if condition is true
      skipWhen:
        - "false"  # Always create for this example
---
# Bundle with readyWhen conditions
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: bundle-with-ready-conditions
  namespace: default
spec:
  resources:
    - id: backend
      kind: Order
      spec:
        name: "backend-service"
      # Custom condition for when this resource is considered ready
      readyWhen:
        - "resources.backend.status.state == 'Synced'"
    - id: frontend
      kind: Pet
      spec:
        name: "frontend-service"
      dependsOn:
        - backend
      readyWhen:
        - "resources.frontend.status.state == 'Synced'"
---
# Paused bundle - reconciliation is suspended
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: paused-bundle
  namespace: default
spec:
  paused: true  # Set to false to resume reconciliation
  resources:
    - id: example
      kind: Order
      spec:
        name: "paused-resource"
---
# Bundle with mixed resource types (CRUD, Query, Action)
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreBundle
metadata:
  name: mixed-types-bundle
  namespace: default
spec:
  resources:
    # CRUD Resource
    - id: main-resource
      kind: Order
      spec:
        name: "created-resource"
    # Query CRD (periodic queries)
    - id: status-query
      kind: PetFindbystatusQuery
      spec: {}
    # Action CRD (one-shot operations)
    - id: post-create-action
      kind: PetUploadimageAction
      spec: {}
      dependsOn:
        - main-resource
