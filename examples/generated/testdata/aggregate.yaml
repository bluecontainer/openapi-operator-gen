# Generated by openapi-operator-gen v0.0.10-27-g49a94a0-dirty
# Example PetstoreAggregate CR without status (spec only)
# This demonstrates creating an aggregate CR for testing
#
# Usage with cel-test:
#   cel-test expressions --cr testdata/aggregate.yaml
#   cel-test expressions --cr testdata/aggregate.yaml --resources testdata/resources.yaml
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreAggregate
metadata:
  name: petstore-aggregate
  namespace: default
spec:
  resourceSelectors:
    - kind: Order
    - kind: Pet
    - kind: User
  aggregationStrategy: AllHealthy
  derivedValues:
    - name: syncPercentage
      expression: "summary.total > 0 ? (summary.synced * 100) / summary.total : 0"
    - name: allSynced
      expression: "summary.total > 0 && summary.synced == summary.total"
    - name: failedResources
      expression: "resources.filter(r, r.status.state == 'Failed').size()"
    - name: orderCount
      expression: "resources.filter(r, r.kind == 'Order').size()"
    - name: petCount
      expression: "resources.filter(r, r.kind == 'Pet').size()"
    - name: userCount
      expression: "resources.filter(r, r.kind == 'User').size()"
