# Generated by openapi-operator-gen v0.0.9-26-gb7d8116-dirty
# Example PetstoreAggregate CR with populated status
# This demonstrates using cel-test with status data from a CR
#
# Usage with cel-test:
#   cel-test expressions --cr testdata/aggregate-with-status.yaml
#   cel-test expressions --cr testdata/aggregate-with-status.yaml --resources testdata/resources.yaml
apiVersion: petstore.example.com/v1alpha1
kind: PetstoreAggregate
metadata:
  name: petstore-aggregate-with-status
  namespace: default
spec:
  resourceSelectors:
    - kind: Order
    - kind: Pet
    - kind: User
  aggregationStrategy: AllHealthy
  derivedValues:
    - name: syncPercentage
      expression: "summary.total > 0 ? (summary.synced * 100) / summary.total : 0"
    - name: allSynced
      expression: "summary.total > 0 && summary.synced == summary.total"
    - name: failedResources
      expression: "resources.filter(r, r.status.state == 'Failed').size()"
    - name: orderCount
      expression: "resources.filter(r, r.kind == 'Order').size()"
    - name: petCount
      expression: "resources.filter(r, r.kind == 'Pet').size()"
    - name: userCount
      expression: "resources.filter(r, r.kind == 'User').size()"
status:
  state: Degraded
  message: "16 of 18 resources synced"
  summary:
    total: 18
    synced: 16
    failed: 1
    pending: 1
  resources:
    # Order resources
    - kind: Order
      name: my-order
      namespace: default
      state: Synced
      externalID: "ext-my-order"
      message: "Successfully synced"
    - kind: Order
      name: critical-order
      namespace: default
      state: Synced
      externalID: "ext-critical-order"
      message: "Successfully synced"
    - kind: Order
      name: test-order-alpha
      namespace: default
      state: Failed
      externalID: ""
      message: "API returned 500 error"
    - kind: Order
      name: test-order-beta
      namespace: default
      state: Synced
      externalID: "ext-test-order-beta"
      message: "Successfully synced"
    - kind: Order
      name: order-001
      namespace: default
      state: Synced
      externalID: "ext-order-001"
      message: "Successfully synced"
    - kind: Order
      name: order-002
      namespace: default
      state: Synced
      externalID: "ext-order-002"
      message: "Successfully synced"
    # Pet resources
    - kind: Pet
      name: my-pet
      namespace: default
      state: Synced
      externalID: "ext-my-pet"
      message: "Successfully synced"
    - kind: Pet
      name: critical-pet
      namespace: default
      state: Synced
      externalID: "ext-critical-pet"
      message: "Successfully synced"
    - kind: Pet
      name: test-pet-alpha
      namespace: default
      state: Synced
      externalID: "ext-test-pet-alpha"
      message: "Successfully synced"
    - kind: Pet
      name: test-pet-beta
      namespace: default
      state: Pending
      externalID: ""
      message: "Waiting for API"
    - kind: Pet
      name: pet-001
      namespace: default
      state: Synced
      externalID: "ext-pet-001"
      message: "Successfully synced"
    - kind: Pet
      name: pet-002
      namespace: default
      state: Synced
      externalID: "ext-pet-002"
      message: "Successfully synced"
    # User resources
    - kind: User
      name: my-user
      namespace: default
      state: Synced
      externalID: "ext-my-user"
      message: "Successfully synced"
    - kind: User
      name: critical-user
      namespace: default
      state: Synced
      externalID: "ext-critical-user"
      message: "Successfully synced"
    - kind: User
      name: test-user-alpha
      namespace: default
      state: Synced
      externalID: "ext-test-user-alpha"
      message: "Successfully synced"
    - kind: User
      name: test-user-beta
      namespace: default
      state: Synced
      externalID: "ext-test-user-beta"
      message: "Successfully synced"
    - kind: User
      name: user-001
      namespace: default
      state: Synced
      externalID: "ext-user-001"
      message: "Successfully synced"
    - kind: User
      name: user-002
      namespace: default
      state: Synced
      externalID: "ext-user-002"
      message: "Successfully synced"
  lastAggregationTime: "2026-01-27T19:44:21Z"
